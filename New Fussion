{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "09159427",
   "metadata": {
    "papermill": {
     "duration": 0.002227,
     "end_time": "2025-12-12T05:15:49.839397",
     "exception": false,
     "start_time": "2025-12-12T05:15:49.837170",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "# Kaggle Training Pipeline for IndianBatsModel\n",
    "\n",
    "This notebook trains the Bat Species Classifier using code from the [IndianBatsModel repository](https://github.com/Quarkisinproton/IndianBatsModel).\n",
    "\n",
    "**Steps:**\n",
    "1.  Clone the repository.\n",
    "2.  Install dependencies.\n",
    "3.  Import functions directly from the codebase.\n",
    "4.  Run the data preparation and training pipeline.\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "55d078a8",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-12-12T05:15:49.843846Z",
     "iopub.status.busy": "2025-12-12T05:15:49.843648Z",
     "iopub.status.idle": "2025-12-12T05:15:56.418970Z",
     "shell.execute_reply": "2025-12-12T05:15:56.418204Z"
    },
    "papermill": {
     "duration": 6.579176,
     "end_time": "2025-12-12T05:15:56.420544",
     "exception": false,
     "start_time": "2025-12-12T05:15:49.841368",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Cloning into 'IndianBatsModel'...\r\n",
      "remote: Enumerating objects: 229, done.\u001b[K\r\n",
      "remote: Counting objects: 100% (229/229), done.\u001b[K\r\n",
      "remote: Compressing objects: 100% (109/109), done.\u001b[K\r\n",
      "remote: Total 229 (delta 125), reused 208 (delta 107), pack-reused 0 (from 0)\u001b[K\r\n",
      "Receiving objects: 100% (229/229), 63.48 KiB | 2.54 MiB/s, done.\r\n",
      "Resolving deltas: 100% (125/125), done.\r\n",
      "Requirement already satisfied: librosa in /usr/local/lib/python3.11/dist-packages (0.11.0)\r\n",
      "Requirement already satisfied: pyyaml in /usr/local/lib/python3.11/dist-packages (6.0.3)\r\n",
      "Requirement already satisfied: pandas in /usr/local/lib/python3.11/dist-packages (2.2.3)\r\n",
      "Requirement already satisfied: matplotlib in /usr/local/lib/python3.11/dist-packages (3.7.2)\r\n",
      "Requirement already satisfied: audioread>=2.1.9 in /usr/local/lib/python3.11/dist-packages (from librosa) (3.0.1)\r\n",
      "Requirement already satisfied: numba>=0.51.0 in /usr/local/lib/python3.11/dist-packages (from librosa) (0.60.0)\r\n",
      "Requirement already satisfied: numpy>=1.22.3 in /usr/local/lib/python3.11/dist-packages (from librosa) (1.26.4)\r\n",
      "Requirement already satisfied: scipy>=1.6.0 in /usr/local/lib/python3.11/dist-packages (from librosa) (1.15.3)\r\n",
      "Requirement already satisfied: scikit-learn>=1.1.0 in /usr/local/lib/python3.11/dist-packages (from librosa) (1.2.2)\r\n",
      "Requirement already satisfied: joblib>=1.0 in /usr/local/lib/python3.11/dist-packages (from librosa) (1.5.2)\r\n",
      "Requirement already satisfied: decorator>=4.3.0 in /usr/local/lib/python3.11/dist-packages (from librosa) (4.4.2)\r\n",
      "Requirement already satisfied: soundfile>=0.12.1 in /usr/local/lib/python3.11/dist-packages (from librosa) (0.13.1)\r\n",
      "Requirement already satisfied: pooch>=1.1 in /usr/local/lib/python3.11/dist-packages (from librosa) (1.8.2)\r\n",
      "Requirement already satisfied: soxr>=0.3.2 in /usr/local/lib/python3.11/dist-packages (from librosa) (0.5.0.post1)\r\n",
      "Requirement already satisfied: typing_extensions>=4.1.1 in /usr/local/lib/python3.11/dist-packages (from librosa) (4.15.0)\r\n",
      "Requirement already satisfied: lazy_loader>=0.1 in /usr/local/lib/python3.11/dist-packages (from librosa) (0.4)\r\n",
      "Requirement already satisfied: msgpack>=1.0 in /usr/local/lib/python3.11/dist-packages (from librosa) (1.1.2)\r\n",
      "Requirement already satisfied: python-dateutil>=2.8.2 in /usr/local/lib/python3.11/dist-packages (from pandas) (2.9.0.post0)\r\n",
      "Requirement already satisfied: pytz>=2020.1 in /usr/local/lib/python3.11/dist-packages (from pandas) (2025.2)\r\n",
      "Requirement already satisfied: tzdata>=2022.7 in /usr/local/lib/python3.11/dist-packages (from pandas) (2025.2)\r\n",
      "Requirement already satisfied: contourpy>=1.0.1 in /usr/local/lib/python3.11/dist-packages (from matplotlib) (1.3.2)\r\n",
      "Requirement already satisfied: cycler>=0.10 in /usr/local/lib/python3.11/dist-packages (from matplotlib) (0.12.1)\r\n",
      "Requirement already satisfied: fonttools>=4.22.0 in /usr/local/lib/python3.11/dist-packages (from matplotlib) (4.59.0)\r\n",
      "Requirement already satisfied: kiwisolver>=1.0.1 in /usr/local/lib/python3.11/dist-packages (from matplotlib) (1.4.8)\r\n",
      "Requirement already satisfied: packaging>=20.0 in /usr/local/lib/python3.11/dist-packages (from matplotlib) (25.0)\r\n",
      "Requirement already satisfied: pillow>=6.2.0 in /usr/local/lib/python3.11/dist-packages (from matplotlib) (11.3.0)\r\n",
      "Requirement already satisfied: pyparsing<3.1,>=2.3.1 in /usr/local/lib/python3.11/dist-packages (from matplotlib) (3.0.9)\r\n",
      "Requirement already satisfied: llvmlite<0.44,>=0.43.0dev0 in /usr/local/lib/python3.11/dist-packages (from numba>=0.51.0->librosa) (0.43.0)\r\n",
      "Requirement already satisfied: mkl_fft in /usr/local/lib/python3.11/dist-packages (from numpy>=1.22.3->librosa) (1.3.8)\r\n",
      "Requirement already satisfied: mkl_random in /usr/local/lib/python3.11/dist-packages (from numpy>=1.22.3->librosa) (1.2.4)\r\n",
      "Requirement already satisfied: mkl_umath in /usr/local/lib/python3.11/dist-packages (from numpy>=1.22.3->librosa) (0.1.1)\r\n",
      "Requirement already satisfied: mkl in /usr/local/lib/python3.11/dist-packages (from numpy>=1.22.3->librosa) (2025.3.0)\r\n",
      "Requirement already satisfied: tbb4py in /usr/local/lib/python3.11/dist-packages (from numpy>=1.22.3->librosa) (2022.3.0)\r\n",
      "Requirement already satisfied: mkl-service in /usr/local/lib/python3.11/dist-packages (from numpy>=1.22.3->librosa) (2.4.1)\r\n",
      "Requirement already satisfied: platformdirs>=2.5.0 in /usr/local/lib/python3.11/dist-packages (from pooch>=1.1->librosa) (4.5.0)\r\n",
      "Requirement already satisfied: requests>=2.19.0 in /usr/local/lib/python3.11/dist-packages (from pooch>=1.1->librosa) (2.32.5)\r\n",
      "Requirement already satisfied: six>=1.5 in /usr/local/lib/python3.11/dist-packages (from python-dateutil>=2.8.2->pandas) (1.17.0)\r\n",
      "Requirement already satisfied: threadpoolctl>=2.0.0 in /usr/local/lib/python3.11/dist-packages (from scikit-learn>=1.1.0->librosa) (3.6.0)\r\n",
      "Requirement already satisfied: cffi>=1.0 in /usr/local/lib/python3.11/dist-packages (from soundfile>=0.12.1->librosa) (2.0.0)\r\n",
      "Requirement already satisfied: pycparser in /usr/local/lib/python3.11/dist-packages (from cffi>=1.0->soundfile>=0.12.1->librosa) (2.23)\r\n",
      "Requirement already satisfied: charset_normalizer<4,>=2 in /usr/local/lib/python3.11/dist-packages (from requests>=2.19.0->pooch>=1.1->librosa) (3.4.4)\r\n",
      "Requirement already satisfied: idna<4,>=2.5 in /usr/local/lib/python3.11/dist-packages (from requests>=2.19.0->pooch>=1.1->librosa) (3.11)\r\n",
      "Requirement already satisfied: urllib3<3,>=1.21.1 in /usr/local/lib/python3.11/dist-packages (from requests>=2.19.0->pooch>=1.1->librosa) (2.5.0)\r\n",
      "Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.11/dist-packages (from requests>=2.19.0->pooch>=1.1->librosa) (2025.10.5)\r\n",
      "Requirement already satisfied: onemkl-license==2025.3.0 in /usr/local/lib/python3.11/dist-packages (from mkl->numpy>=1.22.3->librosa) (2025.3.0)\r\n",
      "Requirement already satisfied: intel-openmp<2026,>=2024 in /usr/local/lib/python3.11/dist-packages (from mkl->numpy>=1.22.3->librosa) (2024.2.0)\r\n",
      "Requirement already satisfied: tbb==2022.* in /usr/local/lib/python3.11/dist-packages (from mkl->numpy>=1.22.3->librosa) (2022.3.0)\r\n",
      "Requirement already satisfied: tcmlib==1.* in /usr/local/lib/python3.11/dist-packages (from tbb==2022.*->mkl->numpy>=1.22.3->librosa) (1.4.0)\r\n",
      "Requirement already satisfied: intel-cmplr-lib-rt in /usr/local/lib/python3.11/dist-packages (from mkl_umath->numpy>=1.22.3->librosa) (2024.2.0)\r\n",
      "Requirement already satisfied: intel-cmplr-lib-ur==2024.2.0 in /usr/local/lib/python3.11/dist-packages (from intel-openmp<2026,>=2024->mkl->numpy>=1.22.3->librosa) (2024.2.0)\r\n"
     ]
    }
   ],
   "source": [
    "# 1. Setup Environment\n",
    "# Clone the repository\n",
    "!git clone https://github.com/Quarkisinproton/IndianBatsModel.git\n",
    "\n",
    "# Install dependencies\n",
    "!pip install librosa pyyaml pandas matplotlib"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "77c30bdb",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-12-12T05:15:56.427265Z",
     "iopub.status.busy": "2025-12-12T05:15:56.426616Z",
     "iopub.status.idle": "2025-12-12T05:16:10.536534Z",
     "shell.execute_reply": "2025-12-12T05:16:10.535707Z"
    },
    "papermill": {
     "duration": 14.11454,
     "end_time": "2025-12-12T05:16:10.537762",
     "exception": false,
     "start_time": "2025-12-12T05:15:56.423222",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Imports successful!\n"
     ]
    }
   ],
   "source": [
    "# 2. Import Modules\n",
    "import sys\n",
    "import os\n",
    "from pathlib import Path\n",
    "\n",
    "# Add paths to sys.path to allow importing modules\n",
    "REPO_DIR = '/kaggle/working/IndianBatsModel'\n",
    "SRC_DIR = os.path.join(REPO_DIR, 'src')\n",
    "\n",
    "# Add both repo root (for 'src.data_prep' imports) and src (for 'datasets' imports)\n",
    "if REPO_DIR not in sys.path:\n",
    "    sys.path.append(REPO_DIR)\n",
    "if SRC_DIR not in sys.path:\n",
    "    sys.path.append(SRC_DIR)\n",
    "\n",
    "# Import project modules directly\n",
    "try:\n",
    "    from src.data_prep.generate_annotations import generate_annotations\n",
    "    from src.data_prep.wombat_to_spectrograms import process_all as generate_spectrograms\n",
    "    from src.data_prep.extract_end_frequency import process_all_and_write_csv as extract_features\n",
    "    from src.train import train_model\n",
    "    print(\"Imports successful!\")\n",
    "except ImportError as e:\n",
    "    print(f\"Import Error: {e}\")\n",
    "    # Fallback: Try importing without 'src.' prefix if path setup behaves differently\n",
    "    from data_prep.generate_annotations import generate_annotations\n",
    "    from data_prep.wombat_to_spectrograms import process_all as generate_spectrograms\n",
    "    from data_prep.extract_end_frequency import process_all_and_write_csv as extract_features\n",
    "    from train import train_model\n",
    "    print(\"Imports successful (fallback)!\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "7ff8f235",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-12-12T05:16:10.544135Z",
     "iopub.status.busy": "2025-12-12T05:16:10.543564Z",
     "iopub.status.idle": "2025-12-12T05:16:10.549865Z",
     "shell.execute_reply": "2025-12-12T05:16:10.549177Z"
    },
    "papermill": {
     "duration": 0.010638,
     "end_time": "2025-12-12T05:16:10.550981",
     "exception": false,
     "start_time": "2025-12-12T05:16:10.540343",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Configuration set.\n"
     ]
    }
   ],
   "source": [
    "# 3. Configuration\n",
    "WORK_DIR = '/kaggle/working'\n",
    "\n",
    "# Input Data Paths (Adjust these to match your Kaggle Dataset structure)\n",
    "RAW_AUDIO_DIRS = [\n",
    "    '/kaggle/input/data-set-2-species/Test Dataset/Pip ceylonicus Train',\n",
    "    '/kaggle/input/data-set-2-species/Test Dataset/Pip Tenuis Train'\n",
    "]\n",
    "\n",
    "# Output Paths\n",
    "JSON_DIR = os.path.join(WORK_DIR, 'data/annotations_json_folder')\n",
    "SPECT_OUT = os.path.join(WORK_DIR, 'data/processed/spectrograms')\n",
    "FEATURES_OUT = os.path.join(WORK_DIR, 'data/processed/features')\n",
    "FEATURES_CSV = os.path.join(FEATURES_OUT, 'end_frequencies.csv')\n",
    "MODEL_SAVE_PATH = os.path.join(WORK_DIR, 'models', 'bat_fused_best.pth')\n",
    "\n",
    "# Ensure directories exist\n",
    "Path(FEATURES_OUT).mkdir(parents=True, exist_ok=True)\n",
    "Path(os.path.dirname(MODEL_SAVE_PATH)).mkdir(parents=True, exist_ok=True)\n",
    "\n",
    "print(\"Configuration set.\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "dcebe95e",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-12-12T05:16:10.557498Z",
     "iopub.status.busy": "2025-12-12T05:16:10.556814Z",
     "iopub.status.idle": "2025-12-12T05:16:17.187397Z",
     "shell.execute_reply": "2025-12-12T05:16:17.186394Z"
    },
    "papermill": {
     "duration": 6.635172,
     "end_time": "2025-12-12T05:16:17.188673",
     "exception": false,
     "start_time": "2025-12-12T05:16:10.553501",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Generating Annotations...\n",
      "Generating annotations for 2 directories...\n",
      "Output directory: /kaggle/working/data/annotations_json_folder\n",
      "Label strategy: folder\n",
      "Found 19 audio files in /kaggle/input/data-set-2-species/Test Dataset/Pip ceylonicus Train\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Processing Pip ceylonicus Train: 100%|██████████| 19/19 [00:06<00:00,  2.94it/s]\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Found 17 audio files in /kaggle/input/data-set-2-species/Test Dataset/Pip Tenuis Train\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Processing Pip Tenuis Train: 100%|██████████| 17/17 [00:00<00:00, 161.19it/s]"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Done.\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\n"
     ]
    }
   ],
   "source": [
    "# 4. Generate Annotations\n",
    "print(\"Generating Annotations...\")\n",
    "generate_annotations(\n",
    "    raw_audio_dirs=RAW_AUDIO_DIRS,\n",
    "    output_dir=JSON_DIR,\n",
    "    label_strategy='folder'\n",
    ")\n",
    "print(\"Done.\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "01f98061",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-12-12T05:16:17.195966Z",
     "iopub.status.busy": "2025-12-12T05:16:17.195369Z",
     "iopub.status.idle": "2025-12-12T05:16:40.457283Z",
     "shell.execute_reply": "2025-12-12T05:16:40.456488Z"
    },
    "papermill": {
     "duration": 23.266858,
     "end_time": "2025-12-12T05:16:40.458590",
     "exception": false,
     "start_time": "2025-12-12T05:16:17.191732",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Generating Spectrograms...\n",
      "Scanning for JSONs in /kaggle/working/data/annotations_json_folder...\n",
      "Found 36 JSON files.\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Processing JSONs:   0%|          | 0/36 [00:00<?, ?it/s]/usr/local/lib/python3.11/dist-packages/librosa/feature/spectral.py:2148: UserWarning: Empty filters detected in mel frequency basis. Some channels will produce empty responses. Try increasing your sampling rate (and fmax) or reducing n_mels.\n",
      "  mel_basis = filters.mel(sr=sr, n_fft=n_fft, **kwargs)\n",
      "Processing JSONs: 100%|██████████| 36/36 [00:23<00:00,  1.55it/s]"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Processed 36 files successfully.\n",
      "Checking output directory: /kaggle/working/data/processed/spectrograms\n",
      "Found 2 species folders: ['Pip_ceylonicus_Train', 'Pip_Tenuis_Train']\n",
      "Total spectrogram images found: 36\n",
      "Done.\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\n"
     ]
    }
   ],
   "source": [
    "# 5. Generate Spectrograms\n",
    "print(\"Generating Spectrograms...\")\n",
    "generate_spectrograms(\n",
    "    raw_audio_dirs=RAW_AUDIO_DIRS,\n",
    "    json_dir=JSON_DIR,\n",
    "    out_dir=SPECT_OUT,\n",
    "    species_key='label'\n",
    ")\n",
    "print(\"Done.\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "e714a3ea",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-12-12T05:16:40.469482Z",
     "iopub.status.busy": "2025-12-12T05:16:40.469033Z",
     "iopub.status.idle": "2025-12-12T05:16:44.419326Z",
     "shell.execute_reply": "2025-12-12T05:16:44.418507Z"
    },
    "papermill": {
     "duration": 3.956919,
     "end_time": "2025-12-12T05:16:44.420753",
     "exception": false,
     "start_time": "2025-12-12T05:16:40.463834",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Extracting Features...\n",
      "Features saved to /kaggle/working/data/processed/features/end_frequencies.csv\n"
     ]
    }
   ],
   "source": [
    "# 6. Extract Features\n",
    "print(\"Extracting Features...\")\n",
    "extract_features(\n",
    "    raw_audio_dirs=RAW_AUDIO_DIRS,\n",
    "    json_dir=JSON_DIR,\n",
    "    out_csv=FEATURES_CSV,\n",
    "    species_key='label'\n",
    ")\n",
    "print(f\"Features saved to {FEATURES_CSV}\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "8eaf4fa7",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-12-12T05:16:44.431338Z",
     "iopub.status.busy": "2025-12-12T05:16:44.431108Z",
     "iopub.status.idle": "2025-12-12T05:16:56.140204Z",
     "shell.execute_reply": "2025-12-12T05:16:56.139180Z"
    },
    "papermill": {
     "duration": 11.715854,
     "end_time": "2025-12-12T05:16:56.141665",
     "exception": false,
     "start_time": "2025-12-12T05:16:44.425811",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Starting Training...\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/usr/local/lib/python3.11/dist-packages/torch/utils/data/dataloader.py:624: UserWarning: This DataLoader will create 8 worker processes in total. Our suggested max number of worker in current system is 4, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.\n",
      "  warnings.warn(\n",
      "/usr/local/lib/python3.11/dist-packages/torchvision/models/_utils.py:208: UserWarning: The parameter 'pretrained' is deprecated since 0.13 and may be removed in the future, please use 'weights' instead.\n",
      "  warnings.warn(\n",
      "/usr/local/lib/python3.11/dist-packages/torchvision/models/_utils.py:223: UserWarning: Arguments other than a weight enum or `None` for 'weights' are deprecated since 0.13 and may be removed in the future. The current behavior is equivalent to passing `weights=ResNet18_Weights.IMAGENET1K_V1`. You can also use `weights=ResNet18_Weights.DEFAULT` to get the most up-to-date weights.\n",
      "  warnings.warn(msg)\n",
      "Downloading: \"https://download.pytorch.org/models/resnet18-f37072fd.pth\" to /root/.cache/torch/hub/checkpoints/resnet18-f37072fd.pth\n",
      "100%|██████████| 44.7M/44.7M [00:00<00:00, 191MB/s]\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch [1/20], Loss: 58.4526\n",
      "Epoch [2/20], Loss: 21.2839\n",
      "Epoch [3/20], Loss: 32.7771\n",
      "Epoch [4/20], Loss: 17.5342\n",
      "Epoch [5/20], Loss: 24.3778\n",
      "Epoch [6/20], Loss: 7.8579\n",
      "Epoch [7/20], Loss: 14.1975\n",
      "Epoch [8/20], Loss: 11.2934\n",
      "Epoch [9/20], Loss: 16.0380\n",
      "Epoch [10/20], Loss: 15.0939\n",
      "Epoch [11/20], Loss: 15.1580\n",
      "Epoch [12/20], Loss: 22.3974\n",
      "Epoch [13/20], Loss: 11.3562\n",
      "Epoch [14/20], Loss: 14.0199\n",
      "Epoch [15/20], Loss: 13.2177\n",
      "Epoch [16/20], Loss: 27.2045\n",
      "Epoch [17/20], Loss: 24.9450\n",
      "Epoch [18/20], Loss: 19.3283\n",
      "Epoch [19/20], Loss: 13.0677\n",
      "Epoch [20/20], Loss: 11.3248\n",
      "Saved model to /kaggle/working/models/bat_fused_best.pth\n",
      "Training Complete! Model saved to /kaggle/working/models/bat_fused_best.pth\n"
     ]
    }
   ],
   "source": [
    "# 7. Run Training\n",
    "# Define Training Configuration Dictionary\n",
    "config = {\n",
    "    'data': {\n",
    "        'train_spectrograms': SPECT_OUT,\n",
    "        'features_csv': FEATURES_CSV,\n",
    "        'num_classes': 3\n",
    "    },\n",
    "    'training': {\n",
    "        'batch_size': 8,\n",
    "        'learning_rate': 1e-3,\n",
    "        'num_epochs': 20,\n",
    "        'model_save_path': MODEL_SAVE_PATH,\n",
    "        'num_workers': 8\n",
    "    }\n",
    "}\n",
    "\n",
    "print(\"Starting Training...\")\n",
    "train_model(config)\n",
    "print(f\"Training Complete! Model saved to {MODEL_SAVE_PATH}\")"
   ]
  }
 ],
 "metadata": {
  "kaggle": {
   "accelerator": "nvidiaTeslaT4",
   "dataSources": [
    {
     "datasetId": 8956228,
     "sourceId": 14070385,
     "sourceType": "datasetVersion"
    }
   ],
   "dockerImageVersionId": 31193,
   "isGpuEnabled": true,
   "isInternetEnabled": true,
   "language": "python",
   "sourceType": "notebook"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.11.13"
  },
  "papermill": {
   "default_parameters": {},
   "duration": 74.596777,
   "end_time": "2025-12-12T05:16:59.300091",
   "environment_variables": {},
   "exception": null,
   "input_path": "__notebook__.ipynb",
   "output_path": "__notebook__.ipynb",
   "parameters": {},
   "start_time": "2025-12-12T05:15:44.703314",
   "version": "2.6.0"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
